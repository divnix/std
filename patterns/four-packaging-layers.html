<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The 4 Packaging Layers - The Standard Documentation</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Tutorials</li><li class="chapter-item expanded "><a href="../tutorials/walk-in-the-park.html"><strong aria-hidden="true">1.</strong> A walk in the park</a></li><li class="chapter-item expanded "><a href="../tutorials/hello-world/index.html"><strong aria-hidden="true">2.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="../tutorials/hello-moon/index.html"><strong aria-hidden="true">3.</strong> Hello Moon</a></li><li class="chapter-item expanded affix "><li class="part-title">How-To Guides</li><li class="chapter-item expanded "><a href="../guides/growing-cells.html"><strong aria-hidden="true">4.</strong> Growing Cells</a></li><li class="chapter-item expanded "><a href="../guides/incl.html"><strong aria-hidden="true">5.</strong> Include Filter</a></li><li class="chapter-item expanded "><a href="../guides/envrc.html"><strong aria-hidden="true">6.</strong> Setup .envrc</a></li><li class="chapter-item expanded affix "><li class="part-title">Explanation</li><li class="chapter-item expanded "><a href="../explain/why-nix.html"><strong aria-hidden="true">7.</strong> Why nix?</a></li><li class="chapter-item expanded "><a href="../explain/why-std.html"><strong aria-hidden="true">8.</strong> Why std?</a></li><li class="chapter-item expanded "><a href="../explain/architecture-decision-records/index.html"><strong aria-hidden="true">9.</strong> Architecture Decisions</a></li><li class="chapter-item expanded affix "><li class="part-title">Patterns</li><li class="chapter-item expanded "><a href="../patterns/four-packaging-layers.html" class="active"><strong aria-hidden="true">10.</strong> The 4 Packaging Layers</a></li><li class="chapter-item expanded affix "><li class="part-title">Templates</li><li class="chapter-item expanded "><a href="../templates/rust.html"><strong aria-hidden="true">11.</strong> Rust</a></li><li class="chapter-item expanded affix "><li class="part-title">Reference</li><li class="chapter-item expanded "><a href="../reference/cli.html"><strong aria-hidden="true">12.</strong> TUI/CLI</a></li><li class="chapter-item expanded "><a href="../reference/conventions.html"><strong aria-hidden="true">13.</strong> Conventions</a></li><li class="chapter-item expanded "><a href="../reference/deprecations.html"><strong aria-hidden="true">14.</strong> Deprecations</a></li><li class="chapter-item expanded "><a href="../reference/blocktypes.html"><strong aria-hidden="true">15.</strong> Builtin Block Types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/blocktypes/data-blocktype.html"><strong aria-hidden="true">15.1.</strong> Data</a></li><li class="chapter-item expanded "><a href="../reference/blocktypes/functions-blocktype.html"><strong aria-hidden="true">15.2.</strong> Functions</a></li><li class="chapter-item expanded "><a href="../reference/blocktypes/runnables-blocktype.html"><strong aria-hidden="true">15.3.</strong> Runnables</a></li><li class="chapter-item expanded "><a href="../reference/blocktypes/installables-blocktype.html"><strong aria-hidden="true">15.4.</strong> Installables</a></li><li class="chapter-item expanded "><a href="../reference/blocktypes/microvms-blocktype.html"><strong aria-hidden="true">15.5.</strong> Microvms</a></li><li class="chapter-item expanded "><a href="../reference/blocktypes/devshells-blocktype.html"><strong aria-hidden="true">15.6.</strong> Devshells</a></li><li class="chapter-item expanded "><a href="../reference/blocktypes/containers-blocktype.html"><strong aria-hidden="true">15.7.</strong> Containers</a></li><li class="chapter-item expanded "><a href="../reference/blocktypes/nixago-blocktype.html"><strong aria-hidden="true">15.8.</strong> Nixago</a></li><li class="chapter-item expanded "><a href="../reference/blocktypes/arion-blocktype.html"><strong aria-hidden="true">15.9.</strong> Arion</a></li><li class="chapter-item expanded "><a href="../reference/blocktypes/nomad-job-manifests-blocktype.html"><strong aria-hidden="true">15.10.</strong> Nomad Job Manifests</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/std/index.html"><strong aria-hidden="true">16.</strong> //std</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/std/cli/index.html"><strong aria-hidden="true">16.1.</strong> /cli</a></li><li class="chapter-item expanded "><a href="../reference/std/devshellProfiles/index.html"><strong aria-hidden="true">16.2.</strong> /devshellProfiles</a></li><li class="chapter-item expanded "><a href="../reference/std/nixago/index.html"><strong aria-hidden="true">16.3.</strong> /nixago</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/std/nixago/adrgen.html"><strong aria-hidden="true">16.3.1.</strong> /adrgen</a></li><li class="chapter-item expanded "><a href="../reference/std/nixago/conform.html"><strong aria-hidden="true">16.3.2.</strong> /conform</a></li><li class="chapter-item expanded "><a href="../reference/std/nixago/editorconfig.html"><strong aria-hidden="true">16.3.3.</strong> /editorconfig</a></li><li class="chapter-item expanded "><a href="../reference/std/nixago/just.html"><strong aria-hidden="true">16.3.4.</strong> /just</a></li><li class="chapter-item expanded "><a href="../reference/std/nixago/lefthook.html"><strong aria-hidden="true">16.3.5.</strong> /lefthook</a></li><li class="chapter-item expanded "><a href="../reference/std/nixago/mdbook.html"><strong aria-hidden="true">16.3.6.</strong> /mdbook</a></li><li class="chapter-item expanded "><a href="../reference/std/nixago/treefmt.html"><strong aria-hidden="true">16.3.7.</strong> /treefmt</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/std/errors/index.html"><strong aria-hidden="true">16.4.</strong> /errors</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/std/errors/removeBy.html"><strong aria-hidden="true">16.4.1.</strong> /removeBy</a></li><li class="chapter-item expanded "><a href="../reference/std/errors/requireInput.html"><strong aria-hidden="true">16.4.2.</strong> /requireInput</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../reference/lib/index.html"><strong aria-hidden="true">17.</strong> //lib</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/lib/dev/index.html"><strong aria-hidden="true">17.1.</strong> /dev</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/lib/dev/mkMakes.html"><strong aria-hidden="true">17.1.1.</strong> /mkMakes</a></li><li class="chapter-item expanded "><a href="../reference/lib/dev/mkShell.html"><strong aria-hidden="true">17.1.2.</strong> /mkShell</a></li><li class="chapter-item expanded "><a href="../reference/lib/dev/mkNixago.html"><strong aria-hidden="true">17.1.3.</strong> /mkNixago</a></li><li class="chapter-item expanded "><a href="../reference/lib/dev/mkArion.html"><strong aria-hidden="true">17.1.4.</strong> /mkArion</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/lib/ops/index.html"><strong aria-hidden="true">17.2.</strong> /ops</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/lib/ops/mkMicrovm.html"><strong aria-hidden="true">17.2.1.</strong> /mkMicrovm</a></li><li class="chapter-item expanded "><a href="../reference/lib/ops/mkOperable.html"><strong aria-hidden="true">17.2.2.</strong> /mkOperable</a></li><li class="chapter-item expanded "><a href="../reference/lib/ops/mkOCI.html"><strong aria-hidden="true">17.2.3.</strong> /mkOCI</a></li><li class="chapter-item expanded "><a href="../reference/lib/ops/mkStandardOCI.html"><strong aria-hidden="true">17.2.4.</strong> /mkStandardOCI</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../reference/presets/index.html"><strong aria-hidden="true">18.</strong> //presets</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/presets/templates/index.html"><strong aria-hidden="true">18.1.</strong> /templates</a></li><li class="chapter-item expanded "><a href="../reference/presets/nixago/index.html"><strong aria-hidden="true">18.2.</strong> /nixago</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/presets/nixago/adrgen.html"><strong aria-hidden="true">18.2.1.</strong> /adrgen</a></li><li class="chapter-item expanded "><a href="../reference/presets/nixago/conform.html"><strong aria-hidden="true">18.2.2.</strong> /conform</a></li><li class="chapter-item expanded "><a href="../reference/presets/nixago/editorconfig.html"><strong aria-hidden="true">18.2.3.</strong> /editorconfig</a></li><li class="chapter-item expanded "><a href="../reference/presets/nixago/lefthook.html"><strong aria-hidden="true">18.2.4.</strong> /lefthook</a></li><li class="chapter-item expanded "><a href="../reference/presets/nixago/mdbook.html"><strong aria-hidden="true">18.2.5.</strong> /mdbook</a></li><li class="chapter-item expanded "><a href="../reference/presets/nixago/treefmt.html"><strong aria-hidden="true">18.2.6.</strong> /treefmt</a></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">19.</strong> //_automation</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/_automation/devshells/index.html"><strong aria-hidden="true">19.1.</strong> /devshells</a></li></ol></li><li class="chapter-item expanded "><a href="../glossary.html"><strong aria-hidden="true">20.</strong> Glossary</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Standard Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <blockquote>
<p><em>This is an opinionated pattern.</em></p>
<p><em>It helps structure working together on microservices with <code>std</code>.</em></p>
</blockquote>
<h1 id="the-4-layers-of-packaging"><a class="header" href="#the-4-layers-of-packaging">The 4 Layers of Packaging</a></h1>
<h2 id="the-problem"><a class="header" href="#the-problem">The Problem</a></h2>
<p>We have written an application and now we want to package and run it.
For its supply chain security benefits, we have been advised to employ reproducible and source-based distribution mechanisms.
We furthermore need an interoperability platform that is generic and versatile: a <em>configuration “lingua franca”</em>.
Our peers who write another application in another language should share that same approach.
Thereby, we avoid the negative external effects of DevOps silos on integrators and operators, alike.
Short: we make adoption of our application as easy as possible for our consumers.</p>
<h2 id="the-actors"><a class="header" href="#the-actors">The Actors</a></h2>
<p><em>Note, that each actor persona can be exercised by one and the same person or a group of persons.
Although possible, and even frequently so, it doesn’t imply that these roles are necessarily taken by distinct individuals.</em></p>
<h3 id="developer"><a class="header" href="#developer">Developer</a></h3>
<p>The Developer persona incrementally modifies the source code.
At times, such modification are relevant at the interface to the Operator persona.
One such example is when the app configuration is modified.
Another one, when important runtime characteristics are amended.</p>
<h3 id="operator"><a class="header" href="#operator">Operator</a></h3>
<p>The Operator persona brings the application to production.
She typically engages in further wrapping code or other artifact creation.
She also supervises and observes the running application across different environments.</p>
<h3 id="release-manager"><a class="header" href="#release-manager">Release Manager</a></h3>
<p>The Release Manager persona cuts releases at discrete points in time.
In doing so, she procures their artifacts for general (public) consumtion.
Any release is tied to a sufficiently high level of assurance of an artifact’s desired properties.
For that purpose, she works with the Developer, Operator &amp; QA personas along these 4 layers of packaging.</p>
<h3 id="qa"><a class="header" href="#qa">QA</a></h3>
<p>The QA persona establishes various levels of assurance of an artifact’s desired properties.
Thereby, the observable artifacts can emanate from any layer of these 4 layers of packaging.
She informs the Developer, Operator and Release Manager personas about any found assurance levels.
She can do so through manual or automatic (CI) means.</p>
<h2 id="the-layers"><a class="header" href="#the-layers">The Layers</a></h2>
<pre class="mermaid">
flowchart TD
    packaging([Packaging])
    operable([Operable])
    image([OCI-Image])
    scheduler([Scheduler Chart])
    packaging --&gt; operable
    operable --&gt; image
    image --&gt; scheduler

    click packaging href &quot;#packaging-layer&quot; &quot;Jump to the packaging layer section&quot;
    click operable href &quot;#operable-layer&quot; &quot;Jump to the operable layer section&quot;
    click image href &quot;#oci-image-layer&quot; &quot;Jump to the OCI image layer section&quot;
    click scheduler href &quot;#scheduler-chart-layer&quot; &quot;Jump to the scheduler chart layer section&quot;
`</pre>
<hr />
<p>There is one very important factoring &amp; interoperability rule about these layers:</p>
<p><em>A domain concern of a higher layer <strong>must not</strong> bleed into previous layers.</em></p>
<p>Observing this very simple rule ensures long term interoperability and maintainability of the stack.
For example, not presuming a particular scheduler in the operable gives contributors a chance to easily add another scheduler target without painful refactoring.</p>
<blockquote>
<p><em><strong>Future Work:</strong> depending on how you count, there may be actually a 5th layer: the <strong>operator</strong> layer. But we may cover this in a future version of this article in further detail. If you don’t want to wait, you may have a conceptual look at the <a href="https://juju.is/docs/olm">Charmed Operator Framework</a> and <a href="https://charmhub.io/">Charmehub</a>.</em></p>
</blockquote>
<p><em>Note, that it would be possible to further fold these interfaces and a Nix veteran might be inclined to do so.
But doing so would defeat the purpose of exposing well defined layered interfaces alongside role-boundaries, subject matter concepts for ease of communication and collaboration; as well as external artifact consumers.</em></p>
<h3 id="packaging-layer"><a class="header" href="#packaging-layer">Packaging Layer</a></h3>
<pre><code class="language-yaml">Cell Block: (blockType.installables &quot;packages&quot;)
Location:  **/packages.nix          # or **/packages/
Actors:
 - Build Expert Panel, Nix- &amp; language-specific
 - Release Manager
</code></pre>
<p>This Cell Block builds, unit-tests &amp; packages the application via the appropriate <a href="../explain/why-nix.html#nix-superpowers">Nix primitives</a>.
Each programming language has a different best practice approach to packaging.
Therfore, a fair ammount of domain knowledge between Nix and the language’s build system is required.</p>
<p>The location of the actual build instructions are secondary.
At minimum, though, for transparency’s and uniformity’s sake, they are still proxied via this Cell Block.
So in the case that upstream already contains appropriate build instructions, the following indirection is perfectly valid (and necessary):</p>
<pre><code class="language-nix">{ inputs, cell }: {
  app = inputs.upstream.packages.some-app;
}
</code></pre>
<p>Build instructions themselves should encompass executing unit tests.
Builds that fail unit tests should already be filtered out at this layer (i.e. “a build that fails unit tests is no build, at all”).</p>
<p>A Release Manager may decide to provide these artifacts to the general public on tagged releases.</p>
<blockquote>
<p><strong>In a hurry?</strong></p>
<p>Fetching binary artifacts and incorporating them at this layer as a temporary work-around for non-production enviornments is acceptable.</p>
</blockquote>
<h3 id="operable-layer"><a class="header" href="#operable-layer">Operable Layer</a></h3>
<pre><code class="language-yaml">Cell Block: (blockType.runnables &quot;operables&quot;)
Location:  **/operables.nix       # or **/operables/
Actors:
 - Developer
 - Operator
</code></pre>
<p>This Cell Block exclusively defines the runtime environment of the application via the operable script.
The role of this script — customarily written in <code>bash</code> — serves as a concise and reified communication channel between Developers and Operators.
As such, Operators will find all the primary configuration options re-encoded at a glance and in a well-known location.
In the other direction, Developers will find all the magic ad-hoc wrapping that Operators had to engage in, in order to run the application on the target scheduler.</p>
<p>Through this communication channel, operators take reliably note of configuration drift, while Developers gain a valuable source of backlog to increase the operational robustness of the application.</p>
<p>Standard includes a <a href="../reference/lib/ops/mkOperable.html">specific library function</a> that establishes an implementation-site interface for operables and their collaterals which significantly eases working on the following layers.</p>
<h3 id="oci-image-layer"><a class="header" href="#oci-image-layer">OCI-Image Layer</a></h3>
<pre><code class="language-yaml">Cell Block: (blockType.containers &quot;oci-images&quot;)
Location:  **/oci-images.nix        # or **/oci-images/
Actors:
 - Operator
 - Release Manager
</code></pre>
<p>This layered packaging pattern promotes source-based distribution in principle.
Despite, in common operating scenarios, we require a security stop-gap separation.
This ensures very fundamentally that nothing is accidentially <em>built</em> on the target (production) worker node, where it would cannibalize critical resources.</p>
<p>We chose OCI-Images as the binary distribution format.
It not only fits that purpose through the <a href="https://github.com/opencontainers/distribution-spec">OCI Distribution Specification</a>, but also collaterally procures interoperability for 3rd parties:
OCI images are the de-facto industry standard for deployment artifacts.</p>
<p>If the operables have been created via the above mentioned <a href="../reference/lib/ops/mkOperable.html">library function</a>.
Using the <a href="../reference/lib/ops/mkStandardOCI.html">Standard OCI image library function</a>, the creation of OCI images trivially reduces to:</p>
<pre><code class="language-nix">{ inputs, cell }: let
  inherit (inputs.std.lib) ops;
in {
  image-hard = ops.mkStandardOCI {
    name = &quot;docker.io/my-image-hardened&quot;;
    operable = cell.operables.app;
  };
  image = ops.mkStandardOCI {
    name = &quot;docker.io/my-image&quot;;
    operable = cell.operables.app;
    debug = true;
  };
}
</code></pre>
<p>Alternatively, any of the avaible Nix-based OCI generation mini-frameworks can be used;
<a href="https://github.com/nlewo/nix2container"><code>nlewo/nix2container</code></a> being the recommended one.
Hence, this mini-framework is internally used by the operables library function.</p>
<p>A Release Manager may decide to provide these artifacts to the general public on tagged releases.</p>
<blockquote>
<p><strong>In a hurry?</strong></p>
<p>Fetching published images and incorporating them at this layer as a temporary work-around for non-production enviornments is acceptable.</p>
</blockquote>
<h3 id="scheduler-chart-layer"><a class="header" href="#scheduler-chart-layer">Scheduler Chart Layer</a></h3>
<pre><code class="language-yaml">Cell Block: (blockType.functions &quot;&lt;sched&gt;Charts&quot;)
Location:  **/&lt;sched&gt;Charts.nix     # or **/&lt;sched&gt;Charts/
Actors:
 - Operator
 - Release Manager
</code></pre>
<p>The scheduler chart is not <em>yet</em> mainfest data.
Rather, it is a function interface that commonly renders to such json-serializable manifest data.
These mainfests are then ingested and interpreted by the scheduler.</p>
<p>A fair amount of scheduler domain knowledge and familiarity with its scheduling options is required, especially
during creation.</p>
<p>These charts can then be processed further downstream (e.g. in Nix code) to specialize out the final manifests and environments.</p>
<p>Since these charts are the basis of various environments for development, staging and production, it is <em>highly</em> recommended to keep their function interface extremely mininmal <strong>and</strong> stable.
This avoids the risk of inadvertely modifying production manifests (e.g. via a human error in the base charts) based on a development or staging requirement.
In these cases, it is <em>highly</em> recommended to resort to data-oriented overlay mechanisms for ad-hoc modification.
A purpose-built tool to do so (called <a href="https://github.com/divnix/data-merge"><code>data-merge</code></a>) is already re-exported under <code>std.dmerge</code> for convenience.
Those modifications should only propagate into a chart interface after <em>stabilizing</em> and after having successfully percolated through all existing environments first.</p>
<p>A Release Manager may decide to provide these artifacts to the general public on tagged releases.
For example: in the transpiled form of a widely used scheduler-specific config sharing format, such as <a href="https://helm.sh/docs/topics/charts/">helm-charts</a>.</p>
<blockquote>
<p><em><strong>Future Work:</strong> it might be a feasible task to extract a common base interface among different schedulers
and thereby implement a base chart that we could simply specialize for each target schedulers (including <code>systemd</code>).
But this may be subject of future research.
Potentially, the above mentioned <a href="https://juju.is/docs/olm">Charmed Operator Framework</a> even obsoletes that need a priori and in practical terms.</em></p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../explain/architecture-decision-records/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../templates/rust.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../explain/architecture-decision-records/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../templates/rust.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../static/mermaid.min.js"></script>
        <script type="text/javascript" src="../static/mermaid-init.js"></script>
    </body>
</html>
