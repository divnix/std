<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Builtin Block Types - The Standard Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../docs/theme/pagetoc.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../ARCHITECTURE.html">Design & Architecture</a></li><li class="chapter-item expanded affix "><a href="../PITCH.html">Sales Pitch</a></li><li class="chapter-item expanded affix "><a href="../COMPARE.html">Comparisions</a></li><li class="chapter-item expanded affix "><a href="../ROADMAP.html">Roadmap</a></li><li class="chapter-item expanded affix "><li class="part-title">Tutorials</li><li class="chapter-item expanded "><a href="../tutorials/walk-in-the-park.html"><strong aria-hidden="true">1.</strong> A walk in the park</a></li><li class="chapter-item expanded "><a href="../tutorials/hello-world/index.html"><strong aria-hidden="true">2.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="../tutorials/hello-moon/index.html"><strong aria-hidden="true">3.</strong> Hello Moon</a></li><li class="chapter-item expanded affix "><li class="part-title">How-To Guides</li><li class="chapter-item expanded "><a href="../guides/growing-cells.html"><strong aria-hidden="true">4.</strong> Growing Cells</a></li><li class="chapter-item expanded "><a href="../guides/incl.html"><strong aria-hidden="true">5.</strong> Include Filter</a></li><li class="chapter-item expanded "><a href="../guides/envrc.html"><strong aria-hidden="true">6.</strong> Setup .envrc</a></li><li class="chapter-item expanded affix "><li class="part-title">Explanation</li><li class="chapter-item expanded "><a href="../explain/why-nix.html"><strong aria-hidden="true">7.</strong> Why nix?</a></li><li class="chapter-item expanded "><a href="../explain/why-std.html"><strong aria-hidden="true">8.</strong> Why std?</a></li><li class="chapter-item expanded "><a href="../explain/architecture-decision-records/index.html"><strong aria-hidden="true">9.</strong> Architecture Decisions</a></li><li class="chapter-item expanded affix "><li class="part-title">Patterns</li><li class="chapter-item expanded "><a href="../patterns/four-packaging-layers.html"><strong aria-hidden="true">10.</strong> The 4 Packaging Layers</a></li><li class="chapter-item expanded "><a href="../patterns/ci-cd-10000-feet.html"><strong aria-hidden="true">11.</strong> CI/CD â€” 10000ft flight height</a></li><li class="chapter-item expanded affix "><li class="part-title">Templates</li><li class="chapter-item expanded "><a href="../templates/minimal.html"><strong aria-hidden="true">12.</strong> Minimal</a></li><li class="chapter-item expanded "><a href="../templates/rust.html"><strong aria-hidden="true">13.</strong> Rust</a></li><li class="chapter-item expanded affix "><li class="part-title">Reference</li><li class="chapter-item expanded "><a href="../reference/cli.html"><strong aria-hidden="true">14.</strong> TUI/CLI</a></li><li class="chapter-item expanded "><a href="../reference/conventions.html"><strong aria-hidden="true">15.</strong> Conventions</a></li><li class="chapter-item expanded "><a href="../reference/deprecations.html"><strong aria-hidden="true">16.</strong> Deprecations</a></li><li class="chapter-item expanded "><a href="../reference/blocktypes.html" class="active"><strong aria-hidden="true">17.</strong> Builtin Block Types</a></li><li class="chapter-item expanded "><a href="../reference/lib.html"><strong aria-hidden="true">18.</strong> Cell: lib</a></li><li class="chapter-item expanded "><a href="../reference/std.html"><strong aria-hidden="true">19.</strong> Cell: std</a></li><li class="chapter-item expanded "><a href="../glossary.html"><strong aria-hidden="true">20.</strong> Glossary</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Standard Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>
<h1 id="builtin-block-types"><a class="header" href="#builtin-block-types">Builtin Block Types</a></h1>
<p>A few Block Types are packaged with <code>std</code>.</p>
<p>In practical terms, Block Types distinguish themselves through the
actions they provide to a particular Cell Block.</p>
<p>It is entirely possible to define custom Block Types with custom
Actions according to the needs of your project.</p>
<h2 id="arion"><a class="header" href="#arion">Arion</a></h2>
<pre><code class="language-nix">{root}:
/*
Use the arion for arionCompose Jobs - https://docs.hercules-ci.com/arion/

Available actions:
  - up
  - ps
  - stop
  - rm
  - config
  - arion
*/
let
  inherit (root) mkCommand;
in
  name: {
    inherit name;
    type = &quot;arion&quot;;
    actions = {
      currentSystem,
      fragment,
      fragmentRelPath,
      target,
      inputs,
    }: let
      pkgs = inputs.nixpkgs.${currentSystem};
      cmd = &quot;arion --prebuilt-file ${target.config.out.dockerComposeYaml}&quot;;
    in [
      (mkCommand currentSystem &quot;up&quot; &quot;arion up&quot; [pkgs.arion] ''${cmd} up &quot;$@&quot; '' {})
      (mkCommand currentSystem &quot;ps&quot; &quot;exec this arion task to ps&quot; [pkgs.arion] ''${cmd} ps &quot;$@&quot; '' {})
      (mkCommand currentSystem &quot;stop&quot; &quot;arion stop&quot; [pkgs.arion] ''${cmd} stop &quot;$@&quot; '' {})
      (mkCommand currentSystem &quot;rm&quot; &quot;arion rm&quot; [pkgs.arion] ''${cmd} rm &quot;$@&quot; '' {})
      (mkCommand currentSystem &quot;config&quot; &quot;check the docker-compose yaml file&quot; [pkgs.arion] ''${cmd} config &quot;$@&quot; '' {})
      (mkCommand currentSystem &quot;arion&quot; &quot;pass any command to arion&quot; [pkgs.arion] ''${cmd} &quot;$@&quot; '' {})
    ];
  }
</code></pre>
<h2 id="runnables-todo-vs-installables"><a class="header" href="#runnables-todo-vs-installables">Runnables (todo: vs installables)</a></h2>
<pre><code class="language-nix">{
  root,
  super,
}:
/*
Use the Runnables Blocktype for targets that you want to
make accessible with a 'run' action on the TUI.
*/
let
  inherit (root) mkCommand actions;
  inherit (super) addSelectorFunctor;
in
  name: {
    __functor = addSelectorFunctor;
    inherit name;
    type = &quot;runnables&quot;;
    actions = {
      currentSystem,
      fragment,
      fragmentRelPath,
      target,
      inputs,
    }: [
      (actions.build currentSystem target)
      (actions.run currentSystem target)
    ];
  }
</code></pre>
<h2 id="installables-todo-vs-runnables"><a class="header" href="#installables-todo-vs-runnables">Installables (todo: vs runnables)</a></h2>
<pre><code class="language-nix">{
  root,
  super,
  nixpkgs,
}:
/*
Use the Installables Blocktype for targets that you want to
make availabe for installation into the user's nix profile.

Available actions:
  - install
  - upgrade
  - remove
  - build
  - bundle
  - bundleImage
  - bundleAppImage
*/
let
  inherit (root) mkCommand actions;
  inherit (super) addSelectorFunctor;
  l = nixpkgs.lib // builtins;
in
  name: {
    __functor = addSelectorFunctor;
    inherit name;
    type = &quot;installables&quot;;
    actions = {
      currentSystem,
      fragment,
      fragmentRelPath,
      target,
      inputs,
    }: let
      escapedFragment = l.escapeShellArg fragment;
    in [
      (actions.build currentSystem target)
      # profile commands require a flake ref
      (mkCommand currentSystem &quot;install&quot; &quot;install this target&quot; [] ''
        # ${target}
        set -x
        nix profile install &quot;$PRJ_ROOT#&quot;${escapedFragment}
      '' {})
      (mkCommand currentSystem &quot;upgrade&quot; &quot;upgrade this target&quot; [] ''
        # ${target}
        set -x
        nix profile upgrade &quot;$PRJ_ROOT#&quot;${escapedFragment}
      '' {})
      (mkCommand currentSystem &quot;remove&quot; &quot;remove this target&quot; [] ''
        # ${target}
        set -x
        nix profile remove &quot;$PRJ_ROOT#&quot;${escapedFragment}
      '' {})
      # TODO: use target. `nix bundle` requires a flake ref, but we may be able to use nix-bundle instead as a workaround
      (mkCommand currentSystem &quot;bundle&quot; &quot;bundle this target&quot; [] ''
        # ${target}
        set -x
        nix bundle --bundler github:Ninlives/relocatable.nix --refresh &quot;$PRJ_ROOT#&quot;${escapedFragment}
      '' {})
      (mkCommand currentSystem &quot;bundleImage&quot; &quot;bundle this target to image&quot; [] ''
        # ${target}
        set -x
        nix bundle --bundler github:NixOS/bundlers#toDockerImage --refresh &quot;$PRJ_ROOT#&quot;${escapedFragment}
      '' {})
      (mkCommand currentSystem &quot;bundleAppImage&quot; &quot;bundle this target to AppImage&quot; [] ''
        # ${target}
        set -x
        nix bundle --bundler github:ralismark/nix-appimage --refresh &quot;$PRJ_ROOT#&quot;${escapedFragment}
      '' {})
    ];
  }
</code></pre>
<h2 id="pkgs"><a class="header" href="#pkgs">Pkgs</a></h2>
<pre><code class="language-nix">_:
/*
Use the Pkgs Blocktype if you need to construct your custom
variant of nixpkgs with overlays.

Targets will be excluded from the CLI / TUI  and thus not
slow them down.
*/
name: {
  inherit name;
  type = &quot;pkgs&quot;;
  cli = false; # its special power
}
</code></pre>
<h2 id="devshells"><a class="header" href="#devshells">Devshells</a></h2>
<pre><code class="language-nix">{  
  root,
  super,
}:
/*
Use the Devshells Blocktype for devShells.

Available actions:
  - build
  - enter
*/
let
  inherit (root) mkCommand actions devshellDrv;
  inherit (super) addSelectorFunctor;
  inherit (builtins) unsafeDiscardStringContext;
in
  name: {
    __functor = addSelectorFunctor;
    inherit name;
    type = &quot;devshells&quot;;
    actions = {
      currentSystem,
      fragment,
      fragmentRelPath,
      target,
      inputs,
    }: let
      developDrv = devshellDrv target;
    in [
      (actions.build currentSystem target)
      (mkCommand currentSystem &quot;enter&quot; &quot;enter this devshell&quot; [] ''
        profile_path=&quot;$PRJ_DATA_HOME/${fragmentRelPath}&quot;
        mkdir -p &quot;$profile_path&quot;
        # ${developDrv}
        nix_args=(
          &quot;${unsafeDiscardStringContext developDrv.drvPath}&quot;
          &quot;--no-update-lock-file&quot;
          &quot;--no-write-lock-file&quot;
          &quot;--no-warn-dirty&quot;
          &quot;--accept-flake-config&quot;
          &quot;--no-link&quot;
          &quot;--build-poll-interval&quot; &quot;0&quot;
          &quot;--builders-use-substitutes&quot;
        )
        nix build &quot;''${nix_args[@]}&quot; --profile &quot;$profile_path/shell-profile&quot;
        _SHELL=&quot;$SHELL&quot;
        eval &quot;$(nix print-dev-env ${developDrv})&quot;
        SHELL=&quot;$_SHELL&quot;
        if ! [[ -v STD_DIRENV ]]; then
          if declare -F __devshell-motd &amp;&gt;/dev/null; then
            __devshell-motd
          fi
          exec $SHELL -i
        fi
      '' {})
    ];
  }
</code></pre>
<h2 id="nixago"><a class="header" href="#nixago">Nixago</a></h2>
<pre><code class="language-nix">{root}:
/*
Use the Nixago Blocktype for nixago pebbles.

Use Nixago pebbles to ensure files are present
or symlinked into your repository. You may typically
use this for repo dotfiles.

For more information, see: https://github.com/nix-community/nixago.

Available actions:
  - ensure
  - explore
*/
let
  inherit (root) mkCommand;
in
  name: {
    inherit name;
    type = &quot;nixago&quot;;
    actions = {
      currentSystem,
      fragment,
      fragmentRelPath,
      target,
      inputs,
    }: let
      pkgs = inputs.nixpkgs.${currentSystem};
    in [
      (mkCommand currentSystem &quot;populate&quot; &quot;populate this nixago file into the repo&quot; [] ''
        ${target.install}/bin/nixago_shell_hook
      '' {})
      (mkCommand currentSystem &quot;explore&quot; &quot;interactively explore the nixago file&quot; [pkgs.bat] ''
        bat &quot;${target.configFile}&quot;
      '' {})
    ];
  }
</code></pre>
<h2 id="containers"><a class="header" href="#containers">Containers</a></h2>
<pre><code class="language-nix">{
  trivial,
  root,
  super,
}:
/*
Use the Containers Blocktype for OCI-images built with nix2container.

Available actions:
  - print-image
  - publish
  - load
*/
let
  inherit (root) mkCommand actions;
  inherit (super) addSelectorFunctor;
  inherit (builtins) readFile toFile;
in
  name: {
    __functor = addSelectorFunctor;
    inherit name;
    type = &quot;containers&quot;;
    actions = {
      currentSystem,
      fragment,
      fragmentRelPath,
      target,
      inputs,
    }: let
      inherit (inputs.n2c.packages.${currentSystem}) skopeo-nix2container;
      triv = trivial.${currentSystem};
      proviso = ./containers-proviso.sh;

      tags' =
        builtins.toFile &quot;${target.name}-tags.json&quot; (builtins.concatStringsSep &quot;\n&quot; target.image.tags);
      copyFn = ''
        copy() {
          local uri prev_tag
          uri=$1
          shift

          for tag in $(&lt;${tags'}); do
            if ! [[ -v prev_tag ]]; then
              skopeo --insecure-policy copy nix:${target} &quot;$uri:$tag&quot; &quot;$@&quot;
            else
              # speedup: copy from the previous tag to avoid superflous network bandwidth
              skopeo --insecure-policy copy &quot;$uri:$prev_tag&quot; &quot;$uri:$tag&quot; &quot;$@&quot;
            fi
            echo &quot;Done: $uri:$tag&quot;

            prev_tag=&quot;$tag&quot;
          done
        }
      '';
    in [
      (actions.build currentSystem target)
      (mkCommand currentSystem &quot;print-image&quot; &quot;print out the image.repo with all tags&quot; [] ''
        echo
        for tag in $(&lt;${tags'}); do
          echo &quot;${target.image.repo}:$tag&quot;
        done
      '' {})
      (mkCommand currentSystem &quot;publish&quot; &quot;copy the image to its remote registry&quot; [skopeo-nix2container] ''
          ${copyFn}
          copy docker://${target.image.repo}
        '' {
          meta.image = target.image.name;
          inherit proviso;
        })
      (mkCommand currentSystem &quot;load&quot; &quot;load image to the local docker daemon&quot; [skopeo-nix2container] ''
        ${copyFn}
        if command -v podman &amp;&gt; /dev/null; then
           echo &quot;Podman detected: copy to local podman&quot;
           copy containers-storage:${target.image.repo} &quot;$@&quot;
        fi
        if command -v docker &amp;&gt; /dev/null; then
           echo &quot;Docker detected: copy to local docker&quot;
           copy docker-daemon:${target.image.repo} &quot;$@&quot;
        fi
      '' {})
    ];
  }
</code></pre>
<h2 id="terra"><a class="header" href="#terra">Terra</a></h2>
<p>Block type for managing <a href="https://terranix.org/">Terranix</a> configuration for <a href="https://www.terraform.io/">Terraform</a>.</p>
<pre><code class="language-nix">{
  root,
  super,
}:
/*
Use the Terra Blocktype for terraform configurations managed by terranix.

Important! You need to specify the state repo on the blocktype, e.g.:

[
  (terra &quot;infra&quot; &quot;git@github.com:myorg/myrepo.git&quot;)
]

Available actions:
  - init
  - plan
  - apply
  - state
  - refresh
  - destroy
*/
let
  inherit (root) mkCommand;
  inherit (super) addSelectorFunctor;
in
  name: repo: {
    inherit name;
    __functor = self: selectors: self // selectors;
    type = &quot;terra&quot;;
    actions = {
      currentSystem,
      fragment,
      fragmentRelPath,
      target,
      inputs,
    }: let
      inherit (inputs) terranix;
      pkgs = inputs.nixpkgs.${currentSystem};

      repoFolder = with pkgs.lib;
        concatStringsSep &quot;/&quot; ([&quot;./nix&quot;] ++ (init (splitString &quot;/&quot; fragmentRelPath)));

      git = {
        inherit repo;
        # repo = &quot;git@github.com:myorg/myrepo.git&quot;;
        ref = &quot;main&quot;;
        state = fragmentRelPath + &quot;/state.json&quot;;
      };

      terraEval = import (terranix + /core/default.nix);
      terraformConfiguration = builtins.toFile &quot;config.tf.json&quot; (builtins.toJSON
        (terraEval {
          inherit pkgs; # only effectively required for `pkgs.lib`
          terranix_config = {
            _file = fragmentRelPath;
            imports = [target];
          };
          strip_nulls = true;
        })
        .config);

      setup = ''
        export TF_IN_AUTOMATION=1
        # export TF_INPUT=0
        export TF_DATA_DIR=&quot;$PRJ_DATA_HOME/${fragmentRelPath}&quot;
        export TF_PLUGIN_CACHE_DIR=&quot;$PRJ_CACHE_HOME/tf-plugin-cache&quot;
        mkdir -p &quot;$TF_DATA_DIR&quot;
        mkdir -p &quot;$TF_PLUGIN_CACHE_DIR&quot;
        dir=&quot;$PRJ_ROOT/${repoFolder}/.tf&quot;
        mkdir -p &quot;$PRJ_ROOT/${repoFolder}/.tf&quot;
        cat &lt;&lt; MESSAGE &gt; &quot;$PRJ_ROOT/${repoFolder}/.tf/readme.md&quot;
        This is a tf staging area.
        It is motivated by the terraform CLI requiring to be executed in a staging area.
        MESSAGE

        if [[ -e &quot;$dir/config.tf.json&quot; ]]; then rm -f &quot;$dir/config.tf.json&quot;; fi
        jq '.' ${terraformConfiguration} &gt; &quot;$dir/config.tf.json&quot;
      '';

      wrap = cmd: ''
        ${setup}
        terraform-backend-git git \
           --dir &quot;$dir&quot; \
           --repository ${git.repo} \
           --ref ${git.ref} \
           --state ${git.state} \
           terraform ${cmd} &quot;$@&quot;;
      '';
    in [
      (mkCommand currentSystem &quot;init&quot; &quot;tf init&quot; [pkgs.jq pkgs.terraform pkgs.terraform-backend-git] (wrap &quot;init&quot;) {})
      (mkCommand currentSystem &quot;plan&quot; &quot;tf plan&quot; [pkgs.jq pkgs.terraform pkgs.terraform-backend-git] (wrap &quot;plan&quot;) {})
      (mkCommand currentSystem &quot;apply&quot; &quot;tf apply&quot; [pkgs.jq pkgs.terraform pkgs.terraform-backend-git] (wrap &quot;apply&quot;) {})
      (mkCommand currentSystem &quot;state&quot; &quot;tf state&quot; [pkgs.jq pkgs.terraform pkgs.terraform-backend-git] (wrap &quot;state&quot;) {})
      (mkCommand currentSystem &quot;refresh&quot; &quot;tf refresh&quot; [pkgs.jq pkgs.terraform pkgs.terraform-backend-git] (wrap &quot;refresh&quot;) {})
      (mkCommand currentSystem &quot;destroy&quot; &quot;tf destroy&quot; [pkgs.jq pkgs.terraform pkgs.terraform-backend-git] (wrap &quot;destroy&quot;) {})
      (mkCommand currentSystem &quot;terraform&quot; &quot;pass any command to terraform&quot; [pkgs.jq pkgs.terraform pkgs.terraform-backend-git] (wrap &quot;&quot;) {})
    ];
  }
</code></pre>
<h2 id="data"><a class="header" href="#data">Data</a></h2>
<pre><code class="language-nix">{
  trivial,
  root,
}:
/*
Use the Data Blocktype for json serializable data.

Available actions:
  - write
  - explore

For all actions is true:
  Nix-proper 'stringContext'-carried dependency will be realized
  to the store, if present.
*/
let
  inherit (root) mkCommand;
  inherit (builtins) toJSON concatStringsSep;
in
  name: {
    inherit name;
    type = &quot;data&quot;;
    actions = {
      currentSystem,
      fragment,
      fragmentRelPath,
      target,
      inputs,
    }: let
      inherit (inputs.nixpkgs.${currentSystem}) pkgs;
      triv = trivial.${currentSystem};

      # if target ? __std_data_wrapper, then we need to unpack from `.data`
      json = triv.writeTextFile {
        name = &quot;data.json&quot;;
        text = toJSON (
          if target ? __std_data_wrapper
          then target.data
          else target
        );
      };
    in [
      (mkCommand currentSystem &quot;write&quot; &quot;write to file&quot; [] &quot;echo ${json}&quot; {})
      (mkCommand currentSystem &quot;explore&quot; &quot;interactively explore&quot; [pkgs.fx] (
        concatStringsSep &quot;\t&quot; [&quot;fx&quot; json]
      ) {})
    ];
  }
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<pre><code class="language-nix">_:
/*
Use the Functions Blocktype for reusable nix functions that you would
call elswhere in the code.

Also use this for all types of modules and profiles, since they are
implemented as functions.

Consequently, there are no actions available for functions.
*/
name: {
  inherit name;
  type = &quot;functions&quot;;
}
</code></pre>
<h2 id="anything"><a class="header" href="#anything">Anything</a></h2>
<p><em>Note: while the implementation is the same as <code>functions</code>, the semantics are different. Implementations may diverge in the future.</em></p>
<pre><code class="language-nix">_:
/*
Use the Anything Blocktype as a fallback.

It doesn't have actions.
*/
name: {
  inherit name;
  type = &quot;anything&quot;;
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../reference/deprecations.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../reference/lib.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../reference/deprecations.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../reference/lib.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../docs/theme/pagetoc.js"></script>


    </div>
    </body>
</html>
